<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Why dotdensity? • dotdensity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Why dotdensity?">
<meta property="og:description" content="dotdensity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dotdensity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/recent_immigrants.html">Recent Immigrants</a>
    </li>
    <li>
      <a href="../articles/why_dotdensity.html">Why dotdensity?</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mountainMath/dotdensity/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Why dotdensity?</h1>
                        <h4 data-toc-skip class="author">Jens von
Bergmann</h4>
            
            <h4 data-toc-skip class="date">2022-04-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mountainMath/dotdensity/blob/HEAD/vignettes/why_dotdensity.Rmd" class="external-link"><code>vignettes/why_dotdensity.Rmd</code></a></small>
      <div class="hidden name"><code>why_dotdensity.Rmd</code></div>

    </div>

    
    
<p>Multi-category dot-density maps can be very effective at
communicating data. They are intuitive and visually appealing. This
package contains two convenience functions that deal with two common
problems with multi-category dot-density maps.</p>
<p>When making dot-density maps we need to transform counts for our
categories to dots that are suitable for drawing. Often we scale the
data so that each dot represents a fixed number of people (or whatever
the base category for our map is). We need to take cafe of two pitfalls
in this process. Our scaled data doesn’t generally contain integer
counts any more but floats that we need to convert to an integer number
of dots we want to draw. Naive rounding can lead to systematic bias in
the total number of dots for each category. To see this, consider an
example where we want to make a dot-density map of mother tongue, and
suppose German as a mother tongue is evenly distributed across all
census regions. When we scale our data so that 1 dot represents 50
people, naive rounding will round the German speakers alway in the same
direction, leading to German speakers getting systematically over- or
under-represented. The solution to this problem is to employ random
rounding instead of simple rounding.</p>
<p>The other problem concerns the ordering of the dots. It is important
that once the data has been transformed into dots that the order of the
dots be randomized so that not all dots of a particular colour are drawn
last. Otherwise the dots drawn last will be visually over-represented in
our map.</p>
<p>The <code>compute_dots</code> method takes care of these two issues
and converts a spatial datframe containing polygon data into a spatial
dataframe containing dots.</p>
<p>The other convenience method concerns the situation where we have
finer information about where in each census region the people are
located. In the Canadian census, block level data gives information
about where in a specific Dissemination Area people are living. The
<code>proportional_reaggregate</code> function will take counts from
higher level census data and proportionally re-aggregate it to block
level. This will result in visually more appealing maps as it
concentrates the dots where people live and will leave other areas, like
parks, empty.</p>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>As an example we look at the population in the Detroit-Windsor area
by race. For the data in the Detroit area we use the
<code>tidycensus</code> package to access the US Census Bureau API.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>racevars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">White =</span> <span class="st">"P005003"</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">Black =</span> <span class="st">"P005004"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Asian =</span> <span class="st">"P005006"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">Hispanic =</span> <span class="st">"P004003"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>categories <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"White"</span>,<span class="st">"Black"</span>,<span class="st">"Asian"</span>,<span class="st">"Hispanic"</span>,<span class="st">"Other"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>detroit <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(<span class="at">geography =</span> <span class="st">"tract"</span>, <span class="at">variables =</span> racevars, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year=</span> <span class="dv">2010</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">state =</span> <span class="st">"MI"</span>, <span class="at">county =</span> <span class="st">"Wayne"</span>, <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">summary_var =</span> <span class="st">"P005001"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">output=</span><span class="st">"wide"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Other=</span>summary_value<span class="sc">-</span>White<span class="sc">-</span>Black<span class="sc">-</span>Asian<span class="sc">-</span>Hispanic, <span class="at">Name=</span>NAME)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Getting data from the 2010 decennial Census</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Using Census Summary File 1</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==</span>                                                                    <span class="er">|</span>   <span class="dv">2</span>%</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==</span>                                                                    <span class="er">|</span>   <span class="dv">3</span>%</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===</span>                                                                   <span class="er">|</span>   <span class="dv">5</span>%</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====</span>                                                                  <span class="er">|</span>   <span class="dv">5</span>%</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====</span>                                                                 <span class="er">|</span>   <span class="dv">7</span>%</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">9</span>%</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======</span>                                                               <span class="er">|</span>  <span class="dv">10</span>%</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========</span>                                                              <span class="er">|</span>  <span class="dv">11</span>%</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">13</span>%</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========</span>                                                           <span class="er">|</span>  <span class="dv">16</span>%</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============</span>                                                         <span class="er">|</span>  <span class="dv">18</span>%</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============</span>                                                       <span class="er">|</span>  <span class="dv">21</span>%</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================</span>                                                     <span class="er">|</span>  <span class="dv">24</span>%</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================</span>                                                   <span class="er">|</span>  <span class="dv">28</span>%</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================</span>                                               <span class="er">|</span>  <span class="dv">33</span>%</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================</span>                                            <span class="er">|</span>  <span class="dv">37</span>%</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">47</span>%</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========================================</span>                             <span class="er">|</span>  <span class="dv">59</span>%</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================</span>                      <span class="er">|</span>  <span class="dv">69</span>%</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span></code></pre></div>
<p>For the Windsor data we use <code>cancensus</code> to access the
CensusMapper API. We choose the 2011 census year to match the data from
the 2010 US decentennial census.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mountainMath/cancensus" class="external-link">cancensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cancensusHelpers</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: rlang</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'rlang'</span>
<span class="co">#&gt; The following objects are masked from 'package:purrr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     %@%, as_function, flatten, flatten_chr, flatten_dbl, flatten_int,</span>
<span class="co">#&gt;     flatten_lgl, flatten_raw, invoke, splice</span>
<span class="co">#&gt; Loading required package: xml2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'xml2'</span>
<span class="co">#&gt; The following object is masked from 'package:rlang':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     as_list</span>
<span class="va">region</span><span class="op">=</span><span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/search_census_regions.html" class="external-link">search_census_regions</a></span><span class="op">(</span><span class="st">"Windsor"</span>,<span class="st">"CA11"</span>,level<span class="op">=</span><span class="st">"CMA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/as_census_region_list.html" class="external-link">as_census_region_list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Querying CensusMapper API for regions data...</span>
<span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/search_census_vectors.html" class="external-link">search_census_vectors</a></span><span class="op">(</span><span class="st">"Visible minority for the population in private households"</span>,<span class="st">"CA16"</span>,<span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/child_census_vectors.html" class="external-link">child_census_vectors</a></span><span class="op">(</span>leaves_only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Warning in search_census_vectors("Visible minority for the population in private</span>
<span class="co">#&gt; households", : search_census_vectors(). See ?find_census_vectors() for more</span>
<span class="co">#&gt; robust search functions.</span>
<span class="va">vectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">variables</span><span class="op">$</span><span class="va">vector</span>,<span class="va">variables</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>
<span class="va">windsor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/get_census.html" class="external-link">get_census</a></span><span class="op">(</span><span class="st">"CA16"</span>,regions<span class="op">=</span><span class="va">region</span>,vectors<span class="op">=</span><span class="va">vectors</span>,level<span class="op">=</span><span class="st">"DA"</span>,geo_format<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>White<span class="op">=</span><span class="va">`Not a visible minority`</span><span class="op">+</span><span class="va">Arab</span><span class="op">+</span><span class="va">`West Asian`</span>,
         Hispanic<span class="op">=</span><span class="va">`Latin American`</span>,
         Asian<span class="op">=</span><span class="va">Chinese</span><span class="op">+</span><span class="va">Korean</span><span class="op">+</span><span class="va">`South Asian`</span><span class="op">+</span><span class="va">Filipino</span><span class="op">+</span><span class="va">`Southeast Asian`</span><span class="op">+</span><span class="va">Japanese</span>,
         Other<span class="op">=</span><span class="va">`Visible minority, n.i.e.`</span><span class="op">+</span><span class="va">`Multiple visible minorities`</span>,
         Name<span class="op">=</span><span class="va">`Region Name`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">detroit</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Reading vectors data from local cache.</span>
<span class="co">#&gt; Reading geo data from local cache.</span></code></pre></div>
<p>We simply combine these two into a common dataframe.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">common_categories</span><span class="op">=</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">detroit</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">windsor</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">detroit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">common_categories</span><span class="op">)</span>,<span class="va">windsor</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">common_categories</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span><span class="op">(</span><span class="va">categories</span>,<span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html" class="external-link">funs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Note: Using an external vector in selections is ambiguous.</span>
<span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Use `all_of(common_categories)` instead of `common_categories` to silence this message.</span>
<span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</span>
<span class="co">#&gt; <span style="color: #555555;">This message is displayed once per session.</span></span>
<span class="co">#&gt; Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">#&gt; Please use a list of either functions or lambdas: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Simple named list: </span>
<span class="co">#&gt;   list(mean = mean, median = median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Auto named with `tibble::lst()`: </span>
<span class="co">#&gt;   tibble::lst(mean, median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Using lambdas</span>
<span class="co">#&gt;   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre></div>
<p>For contextual information we use the <code>rmapzen</code> package to
extract basic OSM vector data from the NextZen tile server.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tarakc02.github.io/rmapzen/" class="external-link">rmapzen</a></span><span class="op">)</span>
<span class="co">#bbox=sf::st_bbox(data %&gt;% sf::st_sf())</span>
<span class="va">bbox_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"../data/bbox.geojson"</span><span class="op">)</span>
<span class="va">bbox</span><span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">bbox_geo</span><span class="op">)</span>
<span class="fu">rmapzen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmapzen/man/mz_set_host.html" class="external-link">mz_set_tile_host_nextzen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"NEXTZEN_API_KEY"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mx_box</span><span class="op">=</span><span class="fu">rmapzen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmapzen/man/mz_bbox.html" class="external-link">mz_rect</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">$</span><span class="va">xmin</span>,<span class="va">bbox</span><span class="op">$</span><span class="va">ymin</span>,<span class="va">bbox</span><span class="op">$</span><span class="va">xmax</span>,<span class="va">bbox</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span>

<span class="va">vector_tiles</span> <span class="op">&lt;-</span> <span class="fu">rmapzen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmapzen/man/mz_vector_tiles.html" class="external-link">mz_vector_tiles</a></span><span class="op">(</span><span class="va">mx_box</span><span class="op">)</span> 

<span class="co"># vector tiles return all layers (roads, water, buildings, etc) in a list</span>
<span class="va">roads</span> <span class="op">&lt;-</span> <span class="fu">rmapzen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmapzen/man/as_sf.html" class="external-link">as_sf</a></span><span class="op">(</span><span class="va">vector_tiles</span><span class="op">$</span><span class="va">roads</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">kind</span> <span class="op">!=</span> <span class="st">"ferry"</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'geojson':</span>
<span class="co">#&gt;   method        from     </span>
<span class="co">#&gt;   print.geojson geojsonsf</span>
<span class="va">water</span> <span class="op">&lt;-</span> <span class="fu">rmapzen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rmapzen/man/as_sf.html" class="external-link">as_sf</a></span><span class="op">(</span><span class="va">vector_tiles</span><span class="op">$</span><span class="va">water</span><span class="op">)</span></code></pre></div>
<p>US census geometries don’t cut out the great lakes very well, which
leads to dots being placed on water. To avoid this, we can optionally
cut out the water.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clean_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_difference</a></span><span class="op">(</span><span class="va">data</span>,
                      <span class="va">water</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">area</span> <span class="op">&gt;</span> <span class="fl">10000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                        <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">detroit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all</span>
<span class="co">#&gt; geometries</span></code></pre></div>
<p>Next we convert our polygon data into dots.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mountainMath/dotdensity" class="external-link">dotdensity</a></span><span class="op">)</span>

<span class="va">dots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_dots.html">compute_dots</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">categories</span>,scale<span class="op">=</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Race<span class="op">=</span><span class="va">Category</span><span class="op">)</span></code></pre></div>
<p>All that’s left is to draw the map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bg_color</span> <span class="op">&lt;-</span> <span class="st">"#111111"</span>
<span class="va">text_color</span> <span class="op">&lt;-</span> <span class="st">"black"</span>
<span class="va">limits</span> <span class="op">&lt;-</span> <span class="va">bbox_geo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">detroit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">st_bbox</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">water</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">roads</span>, size <span class="op">=</span> <span class="fl">.2</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dots</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">Race</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.75</span>,size<span class="op">=</span><span class="fl">0.05</span>,show.legend <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">map_theme</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Detroit/Windsor Population by Race"</span>,subtitle<span class="op">=</span><span class="st">"1 dot = 20 people"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bg_color</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
        plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>, size<span class="op">=</span><span class="fl">1</span>,linetype<span class="op">=</span><span class="st">"solid"</span>,color<span class="op">=</span><span class="va">text_color</span><span class="op">)</span>
        <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum<span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">detroit</span><span class="op">)</span>,
           expand<span class="op">=</span><span class="cn">FALSE</span>,
           xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">$</span><span class="va">xmin</span>,<span class="va">bbox</span><span class="op">$</span><span class="va">xmax</span><span class="op">)</span>,
           ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">$</span><span class="va">ymin</span>,<span class="va">bbox</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 4 rows containing missing values (geom_sf).</span></code></pre></div>
<p><img src="why_dotdensity_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">'../images/race.png'</span>,width<span class="op">=</span><span class="fl">7</span>,height<span class="op">=</span><span class="fl">5</span><span class="op">)</span> 
<span class="co">#&gt; Warning: Removed 4 rows containing missing values (geom_sf).</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jens von Bergmann.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
